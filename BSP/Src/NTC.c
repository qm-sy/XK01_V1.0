#include "NTC.h"

uint16_t MF52E_tab[166] = {
3952,/*-40*/    3945,/*-39*/    3938,/*-38*/    3929,/*-37*/    3920,/*-36*/
3910,/*-35*/    3900,/*-34*/    3888,/*-33*/    3876,/*-32*/    3864,/*-31*/
3850,/*-30*/    3836,/*-29*/    3821,/*-28*/    3805,/*-27*/    3789,/*-26*/
3772,/*-25*/    3754,/*-24*/    3735,/*-23*/    3716,/*-22*/    3695,/*-21*/
3675,/*-20*/    3654,/*-19*/    3632,/*-18*/    3610,/*-17*/    3586,/*-16*/
3563,/*-15*/    3538,/*-14*/    3513,/*-13*/    3487,/*-12*/    3460,/*-11*/
3433,/*-10*/    3404,/*-9*/    	3375,/*-8*/    	3345,/*-7*/    	3315,/*-6*/
3283,/*-5*/    	3251,/*-4*/    	3218,/*-3*/    	3184,/*-2*/    	3150,/*-1*/
3115,/*0*/    	3078,/*1*/    	3040,/*2*/    	3002,/*3*/    	2963,/*4*/
2923,/*5*/    	2882,/*6*/    	2841,/*7*/    	2800,/*8*/    	2758,/*9*/
2715,/*10*/    	2672,/*11*/    	2629,/*12*/    	2585,/*13*/    	2541,/*14*/
2497,/*15*/    	2452,/*16*/    	2407,/*17*/    	2362,/*18*/    	2317,/*19*/
2272,/*20*/    	2227,/*21*/    	2182,/*22*/    	2137,/*23*/    	2092,/*24*/
2048,/*25*/    	2003,/*26*/    	1959,/*27*/    	1915,/*28*/    	1871,/*29*/
1828,/*30*/    	1785,/*31*/    	1743,/*32*/    	1701,/*33*/    	1660,/*34*/
1619,/*35*/    	1578,/*36*/    	1539,/*37*/    	1500,/*38*/    	1461,/*39*/
1423,/*40*/    	1386,/*41*/    	1349,/*42*/    	1314,/*43*/    	1278,/*44*/
1244,/*45*/    	1210,/*46*/    	1177,/*47*/    	1145,/*48*/    	1113,/*49*/
1082,/*50*/    	1052,/*51*/    	1022,/*52*/    	994,/*53*/    	966,/*54*/
938,/*55*/    	912,/*56*/    	886,/*57*/    	860,/*58*/    	836,/*59*/
812,/*60*/    	788,/*61*/    	766,/*62*/    	743,/*63*/    	722,/*64*/
701,/*65*/    	681,/*66*/    	661,/*67*/    	642,/*68*/    	624,/*69*/
606,/*70*/    	588,/*71*/    	571,/*72*/    	555,/*73*/    	539,/*74*/
523,/*75*/    	508,/*76*/    	494,/*77*/    	480,/*78*/    	466,/*79*/
453,/*80*/    	440,/*81*/    	427,/*82*/    	415,/*83*/    	403,/*84*/
392,/*85*/    	381,/*86*/    	371,/*87*/    	361,/*88*/    	351,/*89*/
341,/*90*/    	332,/*91*/    	323,/*92*/    	314,/*93*/    	305,/*94*/
297,/*95*/    	289,/*96*/    	281,/*97*/    	273,/*98*/    	266,/*99*/
259,/*100*/    	252,/*101*/    	245,/*102*/    	239,/*103*/    	233,/*104*/
227,/*105*/    	221,/*106*/    	215,/*107*/    	209,/*108*/    	203,/*109*/
198,/*110*/    	193,/*111*/    	188,/*112*/    	183,/*113*/    	178,/*114*/
173,/*115*/    	168,/*116*/    	164,/*117*/    	160,/*118*/    	155,/*119*/
151,/*120*/    	147,/*121*/    	143,/*122*/    	140,/*123*/    	136,/*124*/
132 /*125*/    												
};

uint8_t *get_temp( void )
{
    static uint8_t temp[4];
    uint16_t adc_val[7] = {0};
    uint16_t temp1_adc = 0;
    uint16_t temp2_adc = 0;
    uint16_t temp3_adc = 0;
    uint16_t temp4_adc = 0;

    /* 1, 取10次adc_val                           */
    for( uint8_t t = 0; t < 10; t++ )
		{
			Get_ADC12bitResult(adc_val);
            temp1_adc = temp1_adc + adc_val[3];
            temp2_adc = temp2_adc + adc_val[4];
            temp3_adc = temp3_adc + adc_val[5];
            temp4_adc = temp4_adc + adc_val[6];
		}	       
    temp1_adc = temp1_adc / 10;
    temp2_adc = temp2_adc / 10;
    temp3_adc = temp3_adc / 10;
    temp4_adc = temp4_adc / 10;

    /* 2, 查表，找到对应温度值                     */
    temp[0] = LookupTable( MF52E_tab, 166, temp1_adc );
    temp[1] = LookupTable( MF52E_tab, 166, temp2_adc );
    temp[2] = LookupTable( MF52E_tab, 166, temp3_adc );
    temp[3] = LookupTable( MF52E_tab, 166, temp4_adc );

    return temp;
}
    
uint8_t LookupTable( uint16_t *temp_tab, uint8_t tab_num, uint16_t adc_val )
{
    uint8_t	temp_val = 0;

    for( uint8_t i = 0; i < (tab_num-1); i++ )
    {
        if(( adc_val >= temp_tab[i] ) && ( adc_val < temp_tab[i+1]) )
        temp_val = i;	
    }
    return temp_val;
}
