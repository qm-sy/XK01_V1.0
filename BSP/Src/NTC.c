#include "NTC.h"

static uint16_t MF52E_tab[166] = {
143,/*-40*/    	150,/*-39*/    	157,/*-38*/    	166,/*-37*/    	175,/*-36*/
185,/*-35*/    	195,/*-34*/    	207,/*-33*/    	219,/*-32*/    	231,/*-31*/
245,/*-30*/    	259,/*-29*/    	274,/*-28*/    	290,/*-27*/    	306,/*-26*/
323,/*-25*/    	341,/*-24*/    	360,/*-23*/    	379,/*-22*/    	400,/*-21*/
420,/*-20*/    	441,/*-19*/    	463,/*-18*/    	485,/*-17*/    	509,/*-16*/
532,/*-15*/    	557,/*-14*/    	582,/*-13*/    	608,/*-12*/    	635,/*-11*/
662,/*-10*/    	691,/*-9*/    	720,/*-8*/    	750,/*-7*/    	780,/*-6*/
812,/*-5*/    	844,/*-4*/    	877,/*-3*/    	911,/*-2*/    	945,/*-1*/
980,/*0*/    	1017,/*1*/    	1055,/*2*/    	1093,/*3*/    	1132,/*4*/
1172,/*5*/    	1213,/*6*/    	1254,/*7*/    	1295,/*8*/    	1337,/*9*/
1380,/*10*/    	1423,/*11*/    	1466,/*12*/    	1510,/*13*/    	1554,/*14*/
1598,/*15*/    	1643,/*16*/    	1688,/*17*/    	1733,/*18*/    	1778,/*19*/
1823,/*20*/    	1868,/*21*/    	1913,/*22*/    	1958,/*23*/    	2003,/*24*/
2047,/*25*/    	2092,/*26*/    	2136,/*27*/    	2180,/*28*/    	2224,/*29*/
2267,/*30*/    	2310,/*31*/    	2352,/*32*/    	2394,/*33*/    	2435,/*34*/
2476,/*35*/    	2517,/*36*/    	2556,/*37*/    	2595,/*38*/    	2634,/*39*/
2672,/*40*/    	2709,/*41*/    	2746,/*42*/    	2781,/*43*/    	2817,/*44*/
2851,/*45*/    	2885,/*46*/    	2918,/*47*/    	2950,/*48*/    	2982,/*49*/
3013,/*50*/    	3043,/*51*/    	3073,/*52*/    	3101,/*53*/    	3129,/*54*/
3157,/*55*/    	3183,/*56*/    	3209,/*57*/    	3235,/*58*/    	3259,/*59*/
3283,/*60*/    	3307,/*61*/    	3329,/*62*/    	3352,/*63*/    	3373,/*64*/
3394,/*65*/    	3414,/*66*/    	3434,/*67*/    	3453,/*68*/    	3471,/*69*/
3489,/*70*/    	3507,/*71*/    	3524,/*72*/    	3540,/*73*/    	3556,/*74*/
3572,/*75*/    	3587,/*76*/    	3601,/*77*/    	3615,/*78*/    	3629,/*79*/
3642,/*80*/    	3655,/*81*/    	3668,/*82*/    	3680,/*83*/    	3692,/*84*/
3703,/*85*/    	3714,/*86*/    	3724,/*87*/    	3734,/*88*/    	3744,/*89*/
3754,/*90*/    	3763,/*91*/    	3772,/*92*/    	3781,/*93*/    	3790,/*94*/
3798,/*95*/    	3806,/*96*/    	3814,/*97*/    	3822,/*98*/    	3829,/*99*/
3836,/*100*/    3843,/*101*/    3850,/*102*/    3856,/*103*/    3862,/*104*/
3868,/*105*/    3874,/*106*/    3880,/*107*/    3886,/*108*/    3892,/*109*/
3897,/*110*/    3902,/*111*/    3907,/*112*/    3912,/*113*/    3917,/*114*/
3922,/*115*/    3927,/*116*/    3931,/*117*/    3935,/*118*/    3940,/*119*/
3944,/*120*/    3948,/*121*/    3952,/*122*/    3955,/*123*/    3959,/*124*/
3963/*125*/    																							
};

uint8_t *get_temp( void )
{
    static uint8_t temp[4];
    uint16_t adc_val[5] = {0};
    uint16_t temp1_adc = 0;
    uint16_t temp2_adc = 0;
    uint16_t temp3_adc = 0;
    uint16_t temp4_adc = 0;

    /* 1, 取10次adc_val                           */
    for( uint8_t t = 0; t < 10; t++ )
		{
			Get_ADC12bitResult(adc_val);
            temp1_adc = temp1_adc + adc_val[1];
            temp2_adc = temp2_adc + adc_val[2];
            temp3_adc = temp3_adc + adc_val[3];
            temp4_adc = temp4_adc + adc_val[4];
		}	       
    temp1_adc = (uint16_t)(temp1_adc / 10);
    temp2_adc = (uint16_t)(temp2_adc / 10);
    temp3_adc = (uint16_t)(temp3_adc / 10);
    temp4_adc = (uint16_t)(temp4_adc / 10);

    //printf(" The value of NTC1:%d  NTC1:%d  NTC1:%d  NTC1:%d \r\n",temp1_adc,temp2_adc,temp3_adc,temp4_adc);
    /* 2, 查表，找到对应温度值                     */
    temp[0] = LookupTable( MF52E_tab, 166, temp1_adc );
    temp[1] = LookupTable( MF52E_tab, 166, temp2_adc );
    temp[2] = LookupTable( MF52E_tab, 166, temp3_adc );
    temp[3] = LookupTable( MF52E_tab, 166, temp4_adc );

    //printf(" The value of NTC1:%d  NTC1:%d  NTC1:%d  NTC1:%d \r\n",temp[0],temp[1],temp[2],temp[3]);
    return temp;
}
    
uint8_t LookupTable( uint16_t *temp_tab, uint8_t tab_num, uint16_t adc_val )
{
    uint8_t	temp_val = 0;

    
    for( uint8_t i = 0; i < tab_num ; i++ )
    {
        if( adc_val >= temp_tab[i] ) 
        {
            if( adc_val < temp_tab[i+1]) 
            {
                temp_val = i;
                //printf("here \r\n");
            }
        } 	
    }
    return temp_val;
}
